{%- comment -%}
_includes/publications/pubs_left.html
Parameters:
  include.pubs           — array of publication objects (optional; falls back to page variable `pubs`)
  include.author_list    — authors to highlight (Array) (optional; falls back to `include.l_authors` then page `l_authors`)
  include.l_authors      — legacy alias for highlight authors (Array)
  include.pub_num        — starting index (optional; falls back to page variable `pub_num`)
  include.background     — optional, set to 1 to use background style
{%- endcomment -%}

{% assign background = include.background | default: 0 %}
{% assign pubs_list = include.pubs | default: pubs %}
{% assign current_num = include.pub_num | default: pub_num %}
{% assign author_list = include.author_list %}
{% if author_list == nil %}
  {% assign author_list = include.l_authors %}
{% endif %}
{% if author_list == nil %}
  {% assign author_list = l_authors %}
{% endif %}
{% if author_list == nil %}
  {% assign author_list = "" | split: "|" %}
{% endif %}

{%- comment -%}
Sort publications by `year` descending (supports values like "2023.3"),
and insert a centered year header when the year changes.
{%- endcomment -%}
{% assign sorted_pubs = pubs_list | sort: "year" | reverse %}
{% assign last_year = "" %}
<div id="pubs">
  {%- for pub in sorted_pubs -%}
    {% assign pub_year = pub.year | strip | split: "." | first %}
    {% if pub_year != last_year %}
      <div class="pub_year">{{ pub_year }}</div>
      {% assign last_year = pub_year %}
    {% endif %}
    <div class="pub" {% if pub.img == nil %}style="height:100px; margin-bottom:-5px"{% endif %}>
      {% if pub.img %}
        {% if background == 1 %}
          <div class="pub_background">
            <img src="/assets/images/pubs/{{ pub.img }}" alt="" title="">
          </div>
        {% else %}
          <div class="pub_left_img">
            <img class="pub_img" src="/assets/images/pubs/{{ pub.img }}" alt="{{ pub.title | escape }}" title="{{ pub.title | escape }}">
          </div>
        {% endif %}
      {% endif %}

      <div class="pub_right_text" {% if pub.img == nil %}style="float:left; width:1000px;"{% endif %}>
        <p style="margin-top:0;">
          <a href="{{ pub.link }}">
            <span>{{ current_num }}. {{ pub.title }}</span>
          </a>
        </p>
        <p>
          {%- assign authors = pub.author | replace: " and ", ", " | replace: ";", "," | split: "," -%}
          {%- for a in authors -%}
            {% assign name = a | strip | remove: "." | remove: "#" | downcase %}
            {% assign found = false %}
            {% for special in author_list %}
              {% assign special_clean = special | strip | remove: "." | downcase %}
              {% if name == special_clean %}
                {% assign found = true %}
                {% break %}
              {% endif %}
            {% endfor %}
            {% if found %}
              <span style="color:#74b9ff; font-weight:bold">{{ a | strip }}</span>
            {% else %}
              {{ a | strip }}
            {% endif %}
            {% unless forloop.last %}, {% endunless %}
          {%- endfor -%}
          <span style="font-style:italic; font-weight:bold;"> {{ pub.publisher }}</span>
          <span> {{ pub.page }}</span>
          <span> ({{ pub.year }})</span>
        </p>

        {%- if pub.highlight -%}
        <p style="font-size:10px">
          <a href="{{ pub.highlight.link }}">
            Highlighted in <span style="font-style:italic; font-weight:bold;">{{ pub.highlight.publisher }}</span>
            {{ pub.highlight.page }} ({{ pub.highlight.year }}): {{ pub.highlight.title }}
          </a>
        </p>
        {%- endif -%}

        {%- if pub.selected -%}
        <p style="font-size:10px">
          <a href="{{ pub.selected.link }}">
            Selected as: <span style="font-style:italic; font-weight:bold;">{{ pub.selected.description }}</span>
          </a>
        </p>
        {%- endif -%}
      </div>
    </div>
    {% assign current_num = current_num | minus: 1 %}
  {%- endfor -%}
</div>
